
<div th:fragment="content">
    <div class="page-header">
        <h2>User Management</h2>
        <a th:href="@{/admin/users/new}" class="btn btn-primary">Add New User</a>
    </div>

    <div class="table-container">
        <table class="profile-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="user : ${users}" th:class="${user.enabled} ? 'active' : 'inactive'">
                    <td th:text="${user.username}">username</td>
                    <td th:text="${user.role}">role</td>
                    <td>
                        <span th:if="${user.enabled}" class="status-badge active">Enabled</span>
                        <span th:unless="${user.enabled}" class="status-badge inactive">Disabled</span>
                    </td>
                    <td class="actions">
                        <a th:href="@{'/admin/users/edit/' + ${user.id}}" class="btn-edit">Edit</a>
                        <button type="button"
					        class="btn-password"
					        th:attr="data-user-id=${user.id}, data-username=${user.username}"
					        onclick="openPasswordModal(this)">
					    Change Password
					</button>
                        <a th:href="@{'/admin/users/delete/' + ${user.id}}"
                           class="btn-delete"
                           onclick="return confirm('Are you sure you want to delete this user?')">Delete</a>
                    </td>
                </tr>
                <tr th:if="${users.empty}">
                    <td colspan="4" class="no-data">No users found. <a th:href="@{/admin/users/new}">Create the first user</a></td>
                </tr>
            </tbody>
        </table>
        <div id="passwordModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closePasswordModal()">&times;</span>
        <h3>Change Password for <span id="modalUsername"></span></h3>
        <form method="post" th:action="@{/admin/users/change-password}" onsubmit="return validatePasswordMatch()">
            <input type="hidden" name="userId" id="modalUserId" />

            <div class="form-group">
                <label for="newPassword">New Password</label>
                <input type="password" name="newPassword" id="newPassword" required />
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" required />
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Update Password</button>
                <button type="button" class="btn btn-secondary" onclick="closePasswordModal()">Cancel</button>
            </div>
        </form>
    </div>
</div>
    </div>
</div>
<script>
function openPasswordModal(button) {
    const userId = button.getAttribute('data-user-id');
    const username = button.getAttribute('data-username');

    document.getElementById('modalUserId').value = userId;
    document.getElementById('modalUsername').textContent = username;
    document.getElementById('passwordModal').style.display = 'flex';
}

function closePasswordModal() {
    document.getElementById('passwordModal').style.display = 'none';
}

function validatePasswordMatch() {
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    if (newPassword !== confirmPassword) {
        alert("Passwords do not match.");
        return false;
    }
    return true;
}
</script>